; Gitea Configuration File - Railway Deployment
; Reference: https://docs.gitea.io/en-us/config-cheat-sheet/

APP_NAME = Gitea on Railway
RUN_USER = git
RUN_MODE = prod

[server]
APP_DATA_PATH     = /var/lib/gitea/data
HTTP_PORT         = 3000
HTTP_ADDR         = 0.0.0.0
PROTOCOL          = %(PROTOCOL)s
DOMAIN            = %(DOMAIN)s
ROOT_URL          = %(PROTOCOL)s://%(DOMAIN)s/

; SSH Configuration untuk Railway (reverse proxy)
DISABLE_SSH       = false
SSH_PORT          = 2222
SSH_LISTEN_PORT   = 2222
SSH_LISTEN_HOST   = 0.0.0.0
START_SSH_SERVER  = true
SSH_KEY_TEST_PATH = /tmp/gitea-ssh-test-key

; Security & Performance
OFFLINE_MODE      = false
GRACEFUL_RESTART_TIMEOUT = 30s
START_SVC_GRACEFULLY = true

[database]
; Menggunakan SQLite untuk simplicity dan reliability di Railway free tier
DB_TYPE  = sqlite3
PATH     = /var/lib/gitea/data/gitea.db

; Jika ada konfigurasi PostgreSQL di masa depan, uncomment:
; DB_TYPE  = postgres
; HOST     = ${DB_HOST}:5432
; NAME     = gitea
; USER     = ${DB_USER}
; PASSWD   = ${DB_PASSWORD}
; SSL_MODE = disable
; MAX_OPEN_CONNS = 20
; CONN_MAX_LIFETIME = 3600

[cache]
ADAPTER = memory
INTERVAL = 60

[session]
PROVIDER        = file
PROVIDER_CONFIG = /var/lib/gitea/data/sessions
COOKIE_NAME     = gitea_session
COOKIE_SECURE   = true
COOKIE_SAME_SITE = Lax
SAME_SITE_COOKIE_LEGACY_WORKAROUND = true

[log]
MODE      = console
LEVEL     = info
ROOT_PATH = /var/lib/gitea/log

[log.console]
LEVEL = info

[security]
; INSTALL_LOCK mencegah setup wizard
INSTALL_LOCK = true
SECRET_KEY   = %(SECRET_KEY)s
INTERNAL_TOKEN = %(INTERNAL_TOKEN)s

; Password hashing
PASSWORD_HASH_ALGO = pbkdf2

[service]
DISABLE_REGISTRATION        = false
REQUIRE_SIGNIN_VIEW         = false
REGISTER_EMAIL_CONFIRM      = false
ENABLE_NOTIFY_MAIL          = false
ALLOW_ONLY_EXTERNAL_REGISTRATION = false
ALLOW_ONLY_EXTERNAL_LOGIN   = false
DEFAULT_ALLOW_CREATE_ORGANIZATION = true

[mailer]
ENABLED = false

[oauth2]
ENABLED = false

[openid]
ENABLE_OPENID_SIGNIN = false

[indexer]
ISSUE_INDEXER_TYPE = bleve
REPO_INDEXER_ENABLED = false

[picture]
DISABLE_GRAVATAR = false

[attachment]
ENABLED = true
PATH    = /var/lib/gitea/data/attachments

[storage]
; Local storage (pada Railway volumes)
STORAGE_TYPE = local

[lfs]
STORAGE_TYPE = local
PATH         = /var/lib/gitea/lfs

[actions]
ENABLED = false

[queue]
TYPE = level
